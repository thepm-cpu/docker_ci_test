name: CI - Build and push to docker

on:
    push:
        branches:
            - main

jobs:
    build-and-push:
        runs-on: ubuntu-latest

        steps:
        - name: checkout code
          uses: actions/checkout@v4

        - name: Log in to dockerhub
          run: echo "${{ secrets.DOCKER_PASSWORD }}" | docker login -u "${{ secrets.DOCKER_USERNAME }}" --password-stdin

        - name: Build and push docker image
          run: |
            docker build -t "${{ secrets.DOCKER_USERNAME }}/flaskapp" .
            docker push "${{ secrets.DOCKER_USERNAME }}/flaskapp"